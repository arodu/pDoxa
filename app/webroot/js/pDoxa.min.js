function iniciar(){$("#layout #bordeBoton").draggable({axis:"x",zIndex:100,cursor:"ew-resize",containment:"#layout",drag:function(e,t){$("#layout #content").css("left",t.position.left+2+"px");$("#layout #left").css("width",t.position.left+"px")},stop:function(e,t){if(t.position.left<=100){$("#layout #left").addClass("no-screen")}else{$("#layout #left").removeClass("no-screen")}}});$("#mainmenu").buttonset();$("#mainmenu a.left").click(function(){cargarContent($(this),"#left","Cargando menu...");return false});$("#mainmenu .inactivo").button("disable");$("#dialog-form").dialog({autoOpen:false,width:400,modal:true,hide:"explode",position:{at:"top-30"},open:function(){$("#dialog-form #formulario").html('<img src="'+globalUrl+'img/loader.gif" /> '+"Cargando...");if(global.formulario){$.ajax({url:global.formulario,dataType:"html",error:function(){window.open(globalUrl)},success:function(e){$("#dialog-form #formulario").html(e)},complete:function(){addClassFormulario()}})}else{$("#dialog-form").dialog("close")}},close:function(){$("#dialog-form #formulario").html("");global.formulario=null},buttons:{Guardar:function(){$("#formularioDialog").submit(function(){$(this).ajaxSubmit({type:"post",success:function(e){if(e=="ok"){$("#dialog-form").dialog("close");global.formulario=null;$("div#tabsContenido").tabs("load",$("div#tabsContenido").tabs("option","active"))}else{$("#dialog-form #formulario").html(e);addClassFormulario()}},complete:function(){reloadAjax("#relacionados")}});return false}).submit()},Cancelar:function(){$("#dialog-form").dialog("close")}}});toogleDatosImpresion();refrescarContenido()}function reloadAjax(e){var t=$(e).find("span#url").text();$.ajax({url:t,dataType:"html",beforeSend:function(){cargador("Cargando datos, por favor espere...")},success:function(t){$(e).html(t)},complete:function(){refrescarBotonesAccionInterno(e);cargador(null)}})}function mensajeFlash(){$("#flashMessage").dialog({hide:"explode",title:"pDoxa",modal:true,buttons:{Aceptar:function(){$(this).dialog("close")}},close:function(){$(this).dialog("destroy")}})}function authMessage(){$("#authMessage").addClass("ui-state-error")}function cambiarEstilos(){var e;$("#cambiarTemas").change(function(){if($("#cambiarTemas option:selected").val()!=""){e=$("#cambiarTemas option:selected").text()}else{e="cupertino"}$("#tema").attr("href",globalUrl+"css/temas/"+e+"/jquery-ui.css")})}function refrescarContenido(){$("#content .paginator a").click(function(){$("#content").load(this.href);return false});$("#content .buttonset").buttonset();$("#content div#accordionContenido").accordion({heightStyle:"fill"});$("#content div#accordionImpresion").accordion({heightStyle:"content"});$("#content div#tabsInformacion").tabs({heightStyle:"fill",fx:{opacity:"toggle",duration:200}});var e=$("#content div#tabsContenido").tabs({fx:{opacity:"toggle",duration:200},activate:function(){},load:function(){refrescarBotonesAccionesContent();toogleDatosImpresion();refrescarCuadroAula();encuentrosCargado()}});e.find(".ui-tabs-nav").sortable({axis:"x",stop:function(){e.tabs("refresh")}});$("#content #formularioAjax").submit(function(){$(this).ajaxSubmit({target:"#content",beforeSubmit:function(){cargador("Cargando datos, por favor espere...")},complete:function(){cargador(null);refrescarContenido()}});return false});mensajeFlash();authMessage();refrescarBotonesAccionesContent();refrescarPaginacion();addClassFormulario();refrescarMultiplesCheckBox();cambiarEstilos()}function refrescarPaginacion(){$(".paginas span.disabled").button({disabled:true});$(".paginas span.current").button({disabled:true});$(".paginas").buttonset();$(".ordenar a").addClass("link");$("#paginacion .paginas a, #paginacion .ordenar a").click(function(){cargarContent($(this),"#paginacion");return false});$("#paginacionContent .paginas a, #paginacionContent .ordenar a").click(function(){cargarContent($(this),"#content");return false});refrescarBotonesAccionInterno("#paginacion")}function refrescarBotonesAccionInterno(e){$(e+" .acciones a").button().click(function(){$(".acciones a").button("disable");if($(this).attr("id")==="borrar"){if(!confirm("¿Esta seguro que desea realizar esta acción?\nUna vez eliminado el registro no podra volver a recuperarlo")){$(".acciones a").button("enable");$(".acciones a.inactivo").button("disable");return false}}cargarContent($(this),"#content");return false});$(e+" .acciones a.inactivo").button("disable");$(e+" .boton a").button();$(e+" .abrir-formulario a").click(function(){global.formulario=$(this).attr("href");$("#dialog-form").dialog("open");return false})}function refrescarBotonesAccionesContent(){$("#content .abrir-formulario a").not("#paginacion a").click(function(){global.formulario=$(this).attr("href");$("#dialog-form").dialog("open");return false});$("#content .acciones a").not("#paginacion a").button().click(function(){$(".acciones a").button("disable");if($(this).attr("id")=="borrar"){if(!confirm("¿Esta seguro que desea realizar esta acción?\nUna vez eliminado el registro no podra volver a recuperarlo")){$(".acciones a").button("enable");$(".acciones a.inactivo").button("disable");return false}}cargarContent($(this),"#content");return false});$("#content .acciones a.inactivo").not("#paginacion a").button("disable");$("#content .boton a").not("#paginacion a").button();$("#content .popup a").click(function(){window.open($(this).attr("href"),"_blank");return false});$("#content .vistaImpresion a").click(function(){$(".valores").attr("value",escape(JSON.stringify(globalFormato)));var e=$($(this).closest("form"));e.attr("action",$(this).attr("href"));e.submit();return false})}function refrescarMenu(){$("#left div#accordionMenu").accordion({heightStyle:"fill"});$("#left .submenu").menu();$("#left .submenu .inactivo").addClass("ui-state-disabled");$("#left .submenu .inactivo a").click(false);$("#left .submenu .content.activo a").click(function(){cargarContent($(this));return false});$("#left .submenu .popup.activo a").click(function(){window.open($(this).attr("href"));return false});refrescarSeleccionarSecciones();resumenHorarios();cambiarEstilos();addClassFormulario()}function cargador(e,t){if(e==null){if(!t){t='<span class="ui-icon ui-icon-check" style="display: inline-block;"></span>Realizado con Exito!'}$("#cargador").html(t);$("#cargador").hide("highlight",{},"slow")}else{$("#cargador").html('<img src="'+globalUrl+'img/loader.gif" /> '+e);$("#cargador").show()}}function cargarContent(e,t,n){var r;if(!n){n="Cargando, por favor espere..."}if(!t){t="#content"}if(typeof e==="string"){r=e}else{r=e.attr("href")}$.ajax({url:r,beforeSend:function(){cargador(n)},error:function(e,t,n){if(e.status==403){alert("La Sesion ha Caducado");window.open(globalUrl,"_self")}},success:function(e){$(t).html(e)},complete:function(){if(t==="#content"){refrescarContenido()}else if(t==="#paginacion"){refrescarPaginacion()}else if(t==="#left"){refrescarMenu()}cargador(null)}})}function refrescarCuadroAula(){var e;$("#content .bloque-libre").droppable({activeClass:"ui-state-hover",hoverClass:"ui-state-active",drop:function(e,t){var n=$(this).find("span.aula_id").text();var r=$(this);var i=r.html();var s=$(this).attr("id");var o=t.draggable.attr("id");$.ajax({url:globalUrl+"bloques/asignarSeccion/"+s+"/"+o,beforeSend:function(){cargador("Guardando Datos...");r.addClass("ui-state-active").removeClass("ui-state-disabled").html('<img src="'+globalUrl+'img/loader.gif" />Cargando..')},success:function(e){if(e!="ok"){r.removeClass("ui-state-active").addClass("ui-state-disabled").html(i);alert(e)}else{$("div#tabsContenido").tabs("load",$("div#tabsContenido").tabs("option","active"))}},complete:function(){cargador(null)}});"ui-state-default"}});$("#content .inactivo").droppable("disable");$("#content .papelera").droppable({greedy:true,accept:".mtr-ocupado,.bloque-ocupado",activeClass:"ui-state-focus",hoverClass:"ui-state-active",drop:function(e,t){var n=$(this);if(confirm("¿Esta seguro que desea eliminar esta seccion del Horario?")){$.ajax({url:globalUrl+"bloques/desasignarSeccion/"+t.draggable.attr("id"),beforeSend:function(){cargador("Borrando Datos...");n.addClass("ui-state-active").find("#texto").html('<img src="'+globalUrl+'img/loader.gif" />Borrando Seccion de Horario..')},success:function(e){},complete:function(){$("div#tabsContenido").tabs("load",$("div#tabsContenido").tabs("option","active"));cargador(null,"Borrado con Exito!")}})}}});$(".bloque-ocupado").draggable({revert:"invalid",cursor:"move",helper:"clone",containment:"#content",scroll:false,zIndex:100,opacity:.8,cursorAt:{top:10,left:10}});$("#cuadroAula .abrir-formulario a").click(function(){global.formulario=$(this).attr("href");$("#dialog-form").dialog("open");return false})}function refrescarMultiplesCheckBox(){$(".check_todos").click(function(e){var t=$(this).closest("fieldset").attr("id");if($(this).is(":checked")){$("#"+t+" .ck:checkbox:not(:checked)").attr("checked","checked")}else{$("#"+t+" .ck:checkbox:checked").removeAttr("checked")}})}function refrescarSeleccionarSecciones(){$("#left .input").addClass("ui-state-default ui-corner-all");$("#btn-maestroAulas").button({icons:{primary:"ui-icon-refresh"}});$("#selectMaterias select").change(function(){$("#selectMaterias select option:selected").each(function(){materia_id=$(this).val();$.ajax({url:globalUrl+"seccions/seleccionar/"+materia_id,success:function(e){$("#selectSecciones").html(e);$("#selectEncuentros").html("")},complete:function(){seccionesCargado()}})});$(this).blur()});addClassFormulario()}function seccionesCargado(){$("#selectSecciones .input").addClass("ui-state-default ui-corner-all");$("#selectSecciones select").change(function(){encuentrosCargado();$(this).blur()});addClassFormulario()}function encuentrosCargado(){$("#selectSecciones select option:selected").each(function(){seccion_id=$(this).val();$.ajax({url:globalUrl+"seccions/seleccionarEncuentros/"+seccion_id,success:function(e){$("#selectEncuentros").html(e)},complete:function(){$(".mtr-libre, .mtr-ocupado").draggable({revert:"invalid",cursor:"move",helper:"clone",scroll:false,zIndex:100,opacity:.8,cursorAt:{top:10,left:10}});$(".irContent a").click(function(){cargarContent($(this));return false})}})})}function addClassFormulario(){var e=$("form input,form select,select, textarea").not("input[type=submit],input[type=button],input[type=hidden]");e.addClass("ui-widget-content ui-corner-all");e.focus(function(){$(this).addClass("ui-state-highlight")});e.blur(function(){$(this).removeClass("ui-state-highlight")});$("form .error").addClass("ui-state-error ui-corner-all");$("form .input").addClass("ui-state-default ui-corner-all");$("form .submit input").button();$("input[type=submit],input[type=button]").button();$("form select.changeSubmit").change(function(){$(this).closest("form").submit()});$("form select[multiple]").chosen({no_results_text:"No encontrado...",width:"95%"}).change(function(){$("form .chosen-container .search-choice").addClass("ui-widget-header ui-corner-all")});$("form .chosen-container .search-choice").addClass("ui-widget-header ui-corner-all");$("form .chosen-container .chosen-choices").addClass("ui-corner-all ui-widget-content");$("form .chosen-container .chosen-results").addClass("ui-state-highlight");$("form .chosen-container .chosen-drop").addClass("ui-corner-bottom ui-widget-content")}function resumenHorarios(){$("#left a#imprimir").click(function(){window.print();return false});$("#left a#actualizar").click(function(){$("div#tabsContenido").tabs("load",$("div#tabsContenido").tabs("option","active"));return false});$("#left #tipo-hora").click(function(){if(globalFormato.hora=="normal"){globalFormato.hora="numero"}else if(globalFormato.hora=="numero"){globalFormato.hora="mil"}else{globalFormato.hora="normal"}toogleHora();return false});$("#left #ocultar-docentes").click(function(){if(globalFormato.docente=="completo"){globalFormato.docente="min"}else if(globalFormato.docente=="min"){globalFormato.docente="oculto"}else{globalFormato.docente="completo"}toogleDocentes();return false});$("#left #ocultar-cupos").click(function(){if(globalFormato.cupo=="completo"){globalFormato.cupo="oculto"}else{globalFormato.cupo="completo"}toogleCupos();return false});$("#left #tipo-dia").click(function(){if(globalFormato.dia=="completo"){globalFormato.dia="avr"}else{globalFormato.dia="completo"}toogleDia();return false});$("#left #tipo-materias").click(function(){if(globalFormato.materia=="completo"){globalFormato.materia="avr"}else{globalFormato.materia="completo"}toogleMateria();return false})}function toogleDocentes(){if(globalFormato.docente=="completo"){$(".docente-completo").attr("style","display: inline;");$(".docente-min").attr("style","display: none;");$(".docente-oculto").attr("style","display: none;")}else if(globalFormato.docente=="min"){$(".docente-completo").attr("style","display: none;");$(".docente-min").attr("style","display: inline;");$(".docente-oculto").attr("style","display: none;")}else{$(".docente-completo").attr("style","display: none;");$(".docente-min").attr("style","display: none;");$(".docente-oculto").attr("style","display: inline;")}}function toogleCupos(){if(globalFormato.cupo=="completo"){$(".cupo-completo").attr("style","display: inline;");$(".cupo-oculto").attr("style","display: none;")}else{$(".cupo-completo").attr("style","display: none;");$(".cupo-oculto").attr("style","display: inline;")}}function toogleHora(){if(globalFormato.hora=="normal"){$("span.hora-normal").attr("style","display: inline;");$("span.hora-numero").attr("style","display: none;");$("span.hora-mil").attr("style","display: none;")}if(globalFormato.hora=="numero"){$("span.hora-normal").attr("style","display: none;");$("span.hora-numero").attr("style","display: inline;");$("span.hora-mil").attr("style","display: none;")}if(globalFormato.hora=="mil"){$("span.hora-normal").attr("style","display: none;");$("span.hora-numero").attr("style","display: none;");$("span.hora-mil").attr("style","display: inline;")}}function toogleDia(){if(globalFormato.dia=="completo"){$("span.dia-comp").attr("style","display: inline;");$("span.dia-avr").attr("style","display: none;")}else{$("span.dia-comp").attr("style","display: none;");$("span.dia-avr").attr("style","display: inline;")}}function toogleMateria(){if(globalFormato.materia=="completo"){$("span.materia-nombre").attr("style","display: inline;");$("span.materia-avr").attr("style","display: none;")}else{$("span.materia-nombre").attr("style","display: none;");$("span.materia-avr").attr("style","display: inline;")}}function toogleDatosImpresion(){toogleDocentes();toogleCupos();toogleHora();toogleDia();toogleMateria()}var global=new Object;global.formulario=null;var globalFormato=new Object;globalFormato["docente"]="completo";globalFormato["hora"]="normal";globalFormato["dia"]="completo";globalFormato["materia"]="completo";globalFormato["cupo"]="completo";$(document).ready(iniciar)